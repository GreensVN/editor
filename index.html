<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Code IDE v15.0 - Ultimate Full-Stack Development Environment</title>
    
    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- CORE ENGINE -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
    
    <!-- JS/TS COMPILERS -->
    <script src="https://unpkg.com/@babel/standalone@7.23.6/babel.min.js"></script>
    <script src="https://unpkg.com/typescript@5.4.5/lib/typescript.js"></script>
    
    <!-- PYTHON ENGINE -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

    <!-- FORMATTERS & LINTERS -->
    <script src="https://unpkg.com/prettier@3.2.5/standalone.js"></script>
    <script src="https://unpkg.com/prettier@3.2.5/plugins/html.js"></script>
    <script src="https://unpkg.com/prettier@3.2.5/plugins/babel.js"></script>
    <script src="https://unpkg.com/prettier@3.2.5/plugins/postcss.js"></script>
    <script src="https://unpkg.com/prettier@3.2.5/plugins/typescript.js"></script>

    <!-- TERMINAL -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-search@0.11.0/lib/xterm-addon-search.min.js"></script>
    
    <!-- MONACO EDITOR -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.js"></script>

    <!-- NOTIFICATIONS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- CHARTS FOR ANALYTICS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-dark: #09090b; --bg-panel: #18181b; --bg-side: #121215;
            --border: #27272a; --text: #e4e4e7; --text-dim: #71717a;
            --primary: #6366f1; --primary-hover: #4f46e5;
            --accent: #a855f7; --error: #ef4444; --success: #22c55e; --warn: #f59e0b;
            --header-h: 48px; --footer-h: 28px; --act-bar-w: 52px; --side-w: 280px;
        }

        /* DARK/LIGHT THEME */
        .theme-light {
            --bg-dark: #f9fafb; --bg-panel: #ffffff; --bg-side: #f3f4f6;
            --border: #e5e7eb; --text: #111827; --text-dim: #6b7280;
            --primary: #4f46e5; --primary-hover: #4338ca;
            --accent: #7c3aed; --error: #dc2626; --success: #16a34a; --warn: #d97706;
        }

        /* CORE */
        * { box-sizing: border-box; outline: none; margin: 0; padding: 0; }
        body { 
            margin:0; background:var(--bg-dark); color:var(--text); 
            font-family:'Inter', sans-serif; height:100vh; overflow:hidden; 
            display:flex; flex-direction:column; user-select: none;
        }
        
        ::-webkit-scrollbar { width:12px; height:12px; }
        ::-webkit-scrollbar-track { background:transparent; }
        ::-webkit-scrollbar-corner { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius:6px; border: 2px solid var(--bg-dark); }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }
        .theme-light ::-webkit-scrollbar-thumb { background: #d1d5db; border-color: var(--bg-dark); }
        .theme-light ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }

        .flex { display:flex; } .col { flex-direction:column; }
        .ac { align-items:center; } .jb { justify-content:space-between; }
        .gap-1 { gap: 4px; } .gap-2 { gap: 8px; } .gap-3 { gap: 12px; }
        .hidden { display:none !important; }
        .full { width: 100%; height: 100%; }
        
        /* LAYOUT COMPONENTS */
        header { 
            height:var(--header-h); background:var(--bg-panel); border-bottom:1px solid var(--border);
            padding:0 16px; display:flex; align-items:center; gap: 12px; z-index: 50; flex-shrink: 0;
            position: relative;
        }
        
        .logo { font-weight:800; font-size:16px; letter-spacing:-0.5px; display:flex; align-items:center; gap:8px; color: #fff; }
        .theme-light .logo { color: #111827; }
        .logo span { background:linear-gradient(to right, var(--primary), var(--accent)); -webkit-background-clip:text; color:transparent; font-size:18px; }
        .logo .beta { font-size:10px; background:#4f46e5; color: white; padding:2px 6px; border-radius:4px; margin-left:4px; }

        .btn {
            background: transparent; color: #a1a1aa; border:1px solid transparent; padding:0 12px; border-radius:6px; 
            cursor:pointer; font-size:13px; display:flex; align-items:center; gap:6px; transition:0.2s; height: 32px;
            font-family: 'Inter', sans-serif;
        }
        .theme-light .btn { color: #6b7280; }
        .btn:hover { background: rgba(255,255,255,0.08); color:var(--text); }
        .theme-light .btn:hover { background: rgba(0,0,0,0.05); }
        .btn:active { transform: translateY(1px); }
        .btn.primary { background: var(--primary); color:white; font-weight:600; padding:0 16px; border: 1px solid var(--primary-hover); }
        .btn.primary:hover { background: var(--primary-hover); box-shadow: 0 0 10px rgba(99, 102, 241, 0.4); }
        .btn.success { background: var(--success); color:white; }
        .btn.danger { background: var(--error); color:white; }
        .btn.icon { padding: 0 8px; width: 32px; justify-content: center; }
        
        .dropdown { position: relative; }
        .dropdown-content {
            position: absolute; top: 100%; left: 0; background: var(--bg-panel); border: 1px solid var(--border);
            border-radius: 6px; padding: 4px; min-width: 180px; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
        }
        .dropdown:hover .dropdown-content { display: block; }
        .dropdown-item { padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; }
        .dropdown-item:hover { background: rgba(255,255,255,0.08); }
        
        /* WORKSPACE */
        #workspace { flex:1; display:flex; overflow:hidden; position:relative; }
        
        .act-bar { width:var(--act-bar-w); background:var(--bg-side); border-right:1px solid var(--border); display:flex; flex-direction:column; align-items:center; padding-top:12px; z-index:10; flex-shrink: 0;}
        .act-btn { width:44px; height:44px; display:flex; align-items:center; justify-content:center; color:#52525b; font-size:20px; cursor:pointer; margin-bottom:4px; transition:0.2s; position:relative; border-radius:8px;}
        .act-btn:hover { color:#a1a1aa; background: rgba(255,255,255,0.05); }
        .act-btn.active { color:var(--primary); background: rgba(255,255,255,0.08); }
        .act-btn.active::before { content:''; position:absolute; left:0; top:10px; bottom:10px; width:3px; background:var(--primary); border-radius:0 4px 4px 0; }
        .act-btn .badge { position:absolute; top:-2px; right:-2px; background:var(--error); color:white; font-size:9px; width:16px; height:16px; border-radius:50%; display:flex; align-items:center; justify-content:center; }

        .sidebar { width:var(--side-w); background:var(--bg-side); border-right:1px solid var(--border); display:none; flex-direction:column; }
        .sidebar.active { display:flex; }
        .sb-head { height:42px; padding:0 16px; display:flex; align-items:center; justify-content:space-between; font-size:11px; font-weight:700; color:#a1a1aa; text-transform:uppercase; letter-spacing:0.5px; background: rgba(0,0,0,0.2); border-bottom:1px solid var(--border);}
        .theme-light .sb-head { background: rgba(0,0,0,0.03); }
        
        /* TREE VIEW */
        .tree { flex:1; overflow-y:auto; padding:8px 0; }
        .t-item { padding:6px 0; cursor:pointer; color:#a1a1aa; font-size:13px; display:flex; align-items:center; transition:0.1s; user-select: none; position: relative; }
        .t-item:hover { background:#2a2a2d; color:#e4e4e7; }
        .theme-light .t-item:hover { background:#e5e7eb; color:#111827; }
        .t-item.active { background:#37373d !important; color:#fff; }
        .theme-light .t-item.active { background:#dbeafe !important; color:#1e40af; }
        .t-item.active::before { content:''; position:absolute; left:0; top:0; bottom:0; width:2px; background:var(--primary); }
        .t-indent { width:100%; display: flex; align-items: center; padding: 4px 0; }
        .t-sub { padding-left: 12px; }
        
        /* EDITOR */
        #main { flex:1; display:flex; flex-direction:column; min-width:0; background:var(--bg-dark); position:relative; overflow: hidden; }
        .tabs { display:flex; background:var(--bg-panel); height:42px; overflow-x:auto; border-bottom:1px solid var(--border); scrollbar-width:none; flex-shrink: 0; }
        .tabs::-webkit-scrollbar { display: none; }
        .tab { display:flex; align-items:center; padding:0 16px; height:100%; border-right:1px solid var(--border); font-size:13px; color:#71717a; cursor:pointer; background: var(--bg-panel); min-width:140px; max-width:220px; gap: 8px; border-top: 2px solid transparent; transition: all 0.2s; position: relative;}
        .tab.active { background:var(--bg-dark); color:#e4e4e7; border-top-color:var(--primary); }
        .theme-light .tab.active { background:#f9fafb; color:#111827; }
        .tab .close { width:18px; height:18px; display:flex; align-items:center; justify-content:center; border-radius:4px; opacity:0; transition:0.2s; font-size: 16px;}
        .tab:hover .close { opacity:0.8; }
        .tab .close:hover { background:#ef4444; color: white; opacity: 1;}
        .tab .dot { width:8px; height:8px; border-radius:50%; background:#71717a; }
        .tab.unsaved .dot { background:#f59e0b; }
        
        /* BOTTOM PANEL */
        #panel-btm { height:240px; border-top:1px solid var(--border); background:var(--bg-panel); display:flex; flex-direction:column; position:absolute; bottom:0; left:0; right:0; z-index: 20; box-shadow: 0 -4px 10px rgba(0,0,0,0.2); }
        .panel-header { height:36px; display:flex; align-items:center; background:var(--bg-panel); border-bottom:1px solid var(--border); }
        .panel-tab { padding:0 16px; height:100%; display:flex; align-items:center; cursor:pointer; border-bottom:1px solid transparent; color: #71717a; font-size: 12px; font-weight: 600; letter-spacing: 0.5px; transition: 0.2s; }
        .panel-tab:hover { color: #e4e4e7; }
        .theme-light .panel-tab:hover { color: #111827; }
        .panel-tab.active { color:var(--primary); border-bottom-color:var(--primary); background: rgba(99, 102, 241, 0.05); }
        .panel-tab .badge { margin-left: 6px; background: var(--error); color: white; font-size: 10px; padding: 1px 4px; border-radius: 8px; }

        /* PREVIEW */
        #preview-wrap { width:0; background:white; display:flex; flex-direction:column; border-left:1px solid var(--border); transition: width 0.2s; position:relative; z-index: 15; }
        #preview-wrap.visible { width: 50%; }
        .url-bar { height:36px; background:#f4f4f5; padding:0 12px; border-bottom:1px solid #ddd; font-size:13px; }
        
        /* HELPERS & UTILS */
        .resizer { position:absolute; z-index:99; background:transparent; transition: background 0.2s; }
        .resizer:hover, .resizer.dragging { background:var(--primary); transition-delay: 0.2s; }
        .r-w { width:6px; height:100%; cursor:col-resize; top:0; }
        .r-h { width:100%; height:6px; cursor:row-resize; top:0; left:0; }

        .image-viewer { flex:1; display:flex; align-items:center; justify-content:center; background:repeating-conic-gradient(#18181b 0% 25%, #27272a 0% 50%) 50% / 20px 20px; overflow:auto; padding:20px; }
        .image-viewer img { max-width:100%; box-shadow:0 0 20px rgba(0,0,0,0.5); }

        /* FOOTER */
        footer { height:var(--footer-h); background:var(--bg-panel); color:var(--text); display:flex; align-items:center; padding:0 16px; font-size:12px; justify-content:space-between; flex-shrink: 0; z-index: 55; border-top:1px solid var(--border); }
        .f-stat { display:flex; gap:16px; font-weight:500; align-items: center; }
        .f-stat span { cursor: pointer; opacity: 0.9; display: flex; align-items: center; gap: 4px; } 
        .f-stat span:hover { opacity: 1; }
        .f-stat i { font-size: 11px; }

        /* MODALS & LOADERS */
        #loader-overlay { position:fixed; inset:0; background:#09090b; z-index:10000; display:flex; flex-direction:column; justify-content:center; align-items:center; }
        .spinner { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.1); border-radius: 50%; border-top-color: var(--primary); animation: spin 0.8s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 9999; display: none; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: var(--bg-panel); border-radius: 12px; padding: 24px; min-width: 400px; max-width: 600px; border: 1px solid var(--border); }
        .modal-header { font-size: 18px; font-weight: 600; margin-bottom: 16px; display: flex; justify-content: space-between; align-items: center; }
        .modal-close { cursor: pointer; font-size: 20px; }
        .modal-body { margin: 16px 0; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px; }

        /* AI CHAT */
        #ai-float { position:absolute; right:20px; bottom:20px; width:420px; height:640px; background:#18181b; border:1px solid #333; z-index:1000; border-radius:12px; display:none; flex-direction:column; box-shadow:0 20px 50px rgba(0,0,0,0.5); animation: popUp 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        @keyframes popUp { from { transform: translateY(20px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        .msg-bubble { background: #27272a; padding: 10px 14px; border-radius: 10px; margin-bottom: 10px; font-size: 14px; max-width: 90%; line-height: 1.5; word-break: break-word; }
        .msg-user { background: var(--primary); color: white; align-self: flex-end; }
        .msg-sys { color: #a1a1aa; border: 1px solid #333; }
        .code-block { background: #111; padding: 10px; border-radius: 6px; font-family: 'JetBrains Mono'; margin-top: 8px; white-space: pre-wrap; font-size: 12px; overflow-x: auto; border: 1px solid #333;}
        .thinking { display: flex; gap: 4px; padding: 10px; }
        .thinking span { width: 8px; height: 8px; background: #a1a1aa; border-radius: 50%; animation: pulse 1.4s infinite; }
        .thinking span:nth-child(2) { animation-delay: 0.2s; }
        .thinking span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

        /* CONTEXT MENU */
        .context-menu { position: fixed; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 6px; padding: 6px; z-index: 9999; min-width: 180px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .context-item { padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px; }
        .context-item:hover { background: rgba(255,255,255,0.08); }
        .context-divider { height: 1px; background: var(--border); margin: 4px 0; }

        /* SEARCH BAR */
        .search-bar { position: absolute; top: 60px; right: 20px; background: var(--bg-panel); border: 1px solid var(--border); border-radius: 8px; padding: 12px; z-index: 100; width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: none; }
        .search-bar.active { display: block; }
        .search-input { width: 100%; padding: 10px; background: var(--bg-side); border: 1px solid var(--border); border-radius: 4px; color: var(--text); font-family: 'JetBrains Mono'; }
        .search-results { max-height: 300px; overflow-y: auto; margin-top: 12px; }

        /* PROGRESS BAR */
        .progress-bar { height: 3px; background: var(--primary); position: absolute; top: 0; left: 0; z-index: 1000; transition: width 0.3s; }
    </style>
</head>
<body>

<!-- BOOT SCREEN -->
<div id="loader-overlay">
    <div class="logo" style="margin-bottom:20px; font-size: 28px;"><i class="fas fa-code"></i> PRO CODE <span>IDE</span></div>
    <div class="spinner"></div>
    <div id="boot-status" style="margin-top:20px; font-family:'JetBrains Mono'; font-size:14px; color:#71717a">INITIALIZING CORE ENGINE...</div>
    <div style="margin-top:30px; font-size:12px; color:#52525b;">v15.0 | Full-Stack Development Environment</div>
</div>

<!-- PROGRESS BAR -->
<div class="progress-bar" id="progress-bar"></div>

<header>
    <div class="logo"><i class="fas fa-layer-group" style="color:var(--primary)"></i> PRO <span>CODE</span> <span class="beta">v15.0</span></div>
    
    <div style="width: 1px; height: 20px; background: var(--border);"></div>
    
    <!-- FILE MENU -->
    <div class="dropdown">
        <button class="btn"><i class="fas fa-file"></i> File</button>
        <div class="dropdown-content">
            <div class="dropdown-item" onclick="Command.trigger('newFile')"><i class="fas fa-file-medical"></i> New File</div>
            <div class="dropdown-item" onclick="Command.trigger('newFolder')"><i class="fas fa-folder-plus"></i> New Folder</div>
            <div class="dropdown-item" onclick="Command.trigger('save')"><i class="fas fa-save"></i> Save (Ctrl+S)</div>
            <div class="dropdown-item" onclick="Command.trigger('saveAll')"><i class="fas fa-save"></i> Save All</div>
            <div class="dropdown-item" onclick="FS.exportZip()"><i class="fas fa-download"></i> Export Project</div>
            <div class="dropdown-item" onclick="FS.importPrompt()"><i class="fas fa-folder-open"></i> Import Project</div>
            <div class="context-divider"></div>
            <div class="dropdown-item" onclick="Project.createFromTemplate()"><i class="fas fa-layer-group"></i> New Project</div>
            <div class="dropdown-item" onclick="Project.share()"><i class="fas fa-share-alt"></i> Share Project</div>
        </div>
    </div>
    
    <!-- EDIT MENU -->
    <div class="dropdown">
        <button class="btn"><i class="fas fa-edit"></i> Edit</button>
        <div class="dropdown-content">
            <div class="dropdown-item" onclick="Command.trigger('undo')"><i class="fas fa-undo"></i> Undo (Ctrl+Z)</div>
            <div class="dropdown-item" onclick="Command.trigger('redo')"><i class="fas fa-redo"></i> Redo (Ctrl+Y)</div>
            <div class="context-divider"></div>
            <div class="dropdown-item" onclick="Command.trigger('find')"><i class="fas fa-search"></i> Find (Ctrl+F)</div>
            <div class="dropdown-item" onclick="Command.trigger('replace')"><i class="fas fa-exchange-alt"></i> Replace (Ctrl+H)</div>
            <div class="context-divider"></div>
            <div class="dropdown-item" onclick="Command.trigger('format')"><i class="fas fa-indent"></i> Format Code</div>
            <div class="dropdown-item" onclick="Command.trigger('comment')"><i class="fas fa-comment"></i> Toggle Comment</div>
        </div>
    </div>
    
    <!-- VIEW MENU -->
    <div class="dropdown">
        <button class="btn"><i class="fas fa-eye"></i> View</button>
        <div class="dropdown-content">
            <div class="dropdown-item" onclick="Layout.toggleLayout('terminal')"><i class="fas fa-terminal"></i> Terminal (Ctrl+`)</div>
            <div class="dropdown-item" onclick="Layout.toggleLayout('preview')"><i class="fas fa-columns"></i> Preview (Ctrl+B)</div>
            <div class="dropdown-item" onclick="Layout.toggleFullscreen()"><i class="fas fa-expand"></i> Full Screen (F11)</div>
            <div class="context-divider"></div>
            <div class="dropdown-item" onclick="Theme.toggle()"><i class="fas fa-moon"></i> Toggle Theme</div>
            <div class="dropdown-item" onclick="Layout.zoomIn()"><i class="fas fa-search-plus"></i> Zoom In</div>
            <div class="dropdown-item" onclick="Layout.zoomOut()"><i class="fas fa-search-minus"></i> Zoom Out</div>
        </div>
    </div>
    
    <div style="flex:1"></div>
    
    <!-- COMMAND PALETTE -->
    <div style="background: var(--bg-side); border-radius: 8px; display:flex; align-items:center; padding: 6px 12px; gap: 8px; border: 1px solid var(--border); width: 300px;">
        <i class="fas fa-search" style="font-size: 12px; color: var(--text-dim);"></i>
        <input id="spotlight" placeholder="Command Palette (Ctrl+Shift+P)" style="background:transparent; border:none; color:var(--text); font-size: 13px; width: 100%;">
        <div style="font-size: 11px; color: var(--text-dim); padding: 2px 6px; background: var(--bg-dark); border-radius: 4px;">Ctrl+P</div>
    </div>

    <div style="flex:1"></div>

    <button class="btn icon" onclick="Layout.toggleLayout('terminal')" title="Terminal (Ctrl+`)"><i class="fas fa-terminal"></i></button>
    <button class="btn icon" onclick="Layout.toggleLayout('preview')" title="Preview (Ctrl+B)"><i class="fas fa-columns"></i></button>
    <button class="btn icon" onclick="Runner.debug()" title="Debug (F9)"><i class="fas fa-bug"></i></button>
    <button class="btn primary" onclick="Runner.exec()" title="Run (F5)"> <i class="fas fa-play"></i> RUN</button>
    <button class="btn icon" onclick="AI.toggle()" style="color: var(--accent)" title="AI Assistant"><i class="fas fa-robot"></i></button>
    <button class="btn icon" onclick="Theme.toggle()" title="Toggle Theme"><i class="fas fa-moon"></i></button>
</header>

<div id="workspace">
    <!-- Activity Bar -->
    <div class="act-bar">
        <div class="act-btn active" data-id="expl" onclick="Layout.setSide('expl')"><i class="far fa-copy"></i></div>
        <div class="act-btn" data-id="search" onclick="Layout.setSide('search')"><i class="fas fa-search"></i></div>
        <div class="act-btn" data-id="git" onclick="Layout.setSide('git')"><i class="fas fa-code-branch"></i></div>
        <div class="act-btn" data-id="ext" onclick="Layout.setSide('ext')"><i class="fas fa-cubes"></i></div>
        <div class="act-btn" data-id="debug" onclick="Layout.setSide('debug')"><i class="fas fa-bug"></i></div>
        <div style="flex:1"></div>
        <div class="act-btn" onclick="Layout.setSide('set')"><i class="fas fa-cog"></i></div>
        <div class="act-btn" onclick="AI.toggle()" style="color: var(--accent)"><i class="fas fa-robot"></i></div>
    </div>

    <!-- Explorer Sidebar -->
    <div id="side-expl" class="sidebar active">
        <div class="sb-head">
            <span>Explorer</span>
            <div class="flex gap-2">
                <i class="fas fa-file-medical" onclick="FS.createFilePrompt()" title="New File" style="cursor:pointer; margin-right:5px"></i>
                <i class="fas fa-folder-plus" onclick="FS.createFolderPrompt()" title="New Folder" style="cursor:pointer"></i>
                <i class="fas fa-sync-alt" onclick="FS.refreshTree()" title="Refresh" style="cursor:pointer"></i>
            </div>
        </div>
        <div id="file-tree" class="tree"></div>
    </div>
    
    <!-- Search Sidebar -->
    <div id="side-search" class="sidebar">
        <div class="sb-head"><span>Search</span></div>
        <div style="padding:16px">
            <input id="search-input" placeholder="Search in files..." class="search-input" onkeyup="Search.find()">
            <div style="margin-top:12px; font-size:12px; color:var(--text-dim);">
                <label><input type="checkbox" id="case-sensitive"> Case sensitive</label>
                <label style="margin-left:12px"><input type="checkbox" id="whole-word"> Whole word</label>
            </div>
            <div id="search-results" class="search-results"></div>
        </div>
    </div>
    
    <!-- Git Sidebar -->
    <div id="side-git" class="sidebar">
        <div class="sb-head"><span>Source Control</span></div>
        <div style="padding:16px">
            <div style="background:var(--bg-dark); padding:12px; border-radius:6px; margin-bottom:12px;">
                <div style="font-size:12px; color:var(--text-dim); margin-bottom:8px;">Changes (3)</div>
                <div style="font-size:13px;">
                    <div style="display:flex; align-items:center; gap:8px; padding:6px 0; border-bottom:1px solid var(--border);">
                        <i class="fas fa-file-code" style="color:var(--success)"></i>
                        <span>main.js</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:8px; padding:6px 0; border-bottom:1px solid var(--border);">
                        <i class="fas fa-file-code" style="color:var(--success)"></i>
                        <span>App.jsx</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:8px; padding:6px 0;">
                        <i class="fas fa-file-code" style="color:var(--warn)"></i>
                        <span>index.html</span>
                    </div>
                </div>
            </div>
            <textarea id="commit-message" placeholder="Commit message" style="width:100%; height:80px; background:var(--bg-dark); border:1px solid var(--border); color:var(--text); padding:8px; border-radius:4px; font-size:13px;"></textarea>
            <button class="btn primary" style="width:100%; margin-top:12px;" onclick="Utils.toast('Committed successfully', 'success')">Commit Changes</button>
        </div>
    </div>
    
    <!-- Debug Sidebar -->
    <div id="side-debug" class="sidebar">
        <div class="sb-head"><span>Debug</span></div>
        <div style="padding:16px">
            <div style="margin-bottom:16px;">
                <select id="debug-config" class="btn" style="width:100%; text-align:left; background:var(--bg-dark);">
                    <option>Node.js</option>
                    <option>Python</option>
                    <option>Browser</option>
                </select>
            </div>
            <button class="btn primary" style="width:100%;" onclick="Runner.debug()"><i class="fas fa-play"></i> Start Debugging (F5)</button>
            <button class="btn" style="width:100%; margin-top:8px;" onclick="Runner.stopDebug()"><i class="fas fa-stop"></i> Stop</button>
            <div style="margin-top:20px; font-size:12px; color:var(--text-dim);">Breakpoints</div>
            <div id="breakpoints-list" style="margin-top:8px; font-size:13px;"></div>
        </div>
    </div>

    <div class="resizer r-w" id="rs-side" style="right:0"></div>

    <!-- Main Editor Area -->
    <div id="main">
        <div class="tabs" id="tab-list"></div>
        <!-- Monaco Mount -->
        <div id="editor-container" style="flex:1; position:relative;">
             <div id="monaco-root" style="width:100%; height:100%;"></div>
             <div id="empty-state" style="position:absolute; inset:0; display:flex; flex-direction:column; justify-content:center; align-items:center; background:var(--bg-dark);">
                <i class="fab fa-connectdevelop" style="font-size:72px; color:var(--border); margin-bottom:20px;"></i>
                <div style="color:var(--text-dim); font-size:16px; margin-bottom:8px;">Welcome to Pro Code IDE</div>
                <div style="color:var(--text-dim); font-size:13px; margin-bottom:24px; text-align:center;">Open a file or create a new project to get started</div>
                <button class="btn primary" onclick="Project.createFromTemplate()"><i class="fas fa-plus"></i> New Project</button>
             </div>
        </div>

        <!-- Terminal Panel -->
        <div id="panel-btm" class="hidden">
            <div class="resizer r-h" id="rs-panel" style="cursor: row-resize;"></div>
            <div class="panel-header">
                <div class="panel-tab active" onclick="Panel.show('term')">TERMINAL</div>
                <div class="panel-tab" onclick="Panel.show('console')">DEBUG CONSOLE</div>
                <div class="panel-tab" onclick="Panel.show('problems')">PROBLEMS <span class="badge">3</span></div>
                <div class="panel-tab" onclick="Panel.show('output')">OUTPUT</div>
                <div class="panel-tab" onclick="Panel.show('git')">GIT</div>
                <div style="flex:1"></div>
                <div class="panel-tab" onclick="Term.instance.clear()"><i class="fas fa-trash"></i></div>
                <div class="panel-tab" onclick="Term.instance.write('\x1b[2J\x1b[0;0H')"><i class="fas fa-ban"></i></div>
                <div class="panel-tab" onclick="Layout.toggleLayout('terminal')"><i class="fas fa-times"></i></div>
            </div>
            <div id="panel-body" style="flex:1; background:#09090b; position:relative; overflow:hidden;">
                <div id="term-host" class="full"></div>
                <div id="console-host" class="full hidden" style="padding:12px; overflow:auto; font-family:'JetBrains Mono', monospace; font-size:13px;"></div>
                <div id="problems-host" class="full hidden" style="padding:12px; overflow:auto;">
                    <div style="font-size:13px; margin-bottom:12px; color:var(--text);">Problems (3)</div>
                    <div style="background:rgba(239,68,68,0.1); padding:8px; border-radius:4px; margin-bottom:8px; border-left:3px solid var(--error);">
                        <div style="display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-times-circle" style="color:var(--error)"></i>
                            <span>Unused variable 'x' (main.js:12)</span>
                        </div>
                    </div>
                    <div style="background:rgba(245,158,11,0.1); padding:8px; border-radius:4px; margin-bottom:8px; border-left:3px solid var(--warn);">
                        <div style="display:flex; align-items:center; gap:8px;">
                            <i class="fas fa-exclamation-triangle" style="color:var(--warn)"></i>
                            <span>Missing semicolon (App.jsx:24)</span>
                        </div>
                    </div>
                </div>
                <div id="output-host" class="full hidden" style="padding:12px; overflow:auto; font-family:'JetBrains Mono'; font-size:12px; white-space: pre-wrap;"></div>
                <div id="git-host" class="full hidden" style="padding:12px; overflow:auto;">
                    <div style="display:flex; align-items:center; justify-content:center; height:100%; color:var(--text-dim);">
                        <div style="text-align:center;">
                            <i class="fas fa-code-branch" style="font-size:48px; margin-bottom:16px;"></i>
                            <div>Git Graph Visualization</div>
                            <div style="font-size:12px; margin-top:8px;">Initialize git repository to see graph</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview / Runner -->
    <div class="resizer r-w hidden" id="rs-preview" style="left:0;"></div>
    <div id="preview-wrap">
        <div class="url-bar flex ac jb">
             <div class="flex ac gap-2" style="font-size:13px; color:#444;">
                 <i class="fas fa-globe"></i> 
                 <input id="preview-url" value="http://localhost:3000" style="border:none; background:transparent; color:#444; width:200px;">
             </div>
             <div class="flex gap-3">
                 <i class="fas fa-mobile-alt" onclick="Runner.toggleMobileView()" style="cursor:pointer; color:#666; font-size:14px;" title="Mobile View"></i>
                 <i class="fas fa-sync" onclick="Runner.exec()" style="cursor:pointer; color:#666; font-size:14px;" title="Refresh"></i>
                 <i class="fas fa-external-link-alt" onclick="Runner.popout()" style="cursor:pointer; color:#666; font-size:14px;" title="Open in new tab"></i>
                 <i class="fas fa-download" onclick="Runner.exportHTML()" style="cursor:pointer; color:#666; font-size:14px;" title="Export HTML"></i>
             </div>
        </div>
        <iframe id="preview-frame" style="flex:1; border:none; background:white;"></iframe>
    </div>
</div>

<footer>
    <div class="f-stat">
        <span><i class="fas fa-code-branch"></i> main</span>
        <span><i class="fas fa-code"></i> UTF-8</span>
        <span><i class="fas fa-file-code"></i> JavaScript</span>
    </div>
    
    <div style="flex:1"></div>
    
    <div class="f-stat">
        <span id="cursor-pos">Ln 1, Col 1</span>
        <span id="file-lang">Plain Text</span>
        <span id="file-size">0b</span>
    </div>
    
    <div style="flex:1"></div>
    
    <div class="f-stat">
        <span id="error-count" onclick="Panel.show('problems')"><i class="fas fa-times-circle" style="color:var(--error)"></i> 0</span>
        <span id="warning-count" onclick="Panel.show('problems')"><i class="fas fa-exclamation-triangle" style="color:var(--warn)"></i> 0</span>
        <span id="connection-status"><i class="fas fa-wifi" style="color:var(--success)"></i></span>
    </div>
    
    <div style="width:24px; text-align:center; cursor:pointer;" onclick="Settings.show()">
        <i class="fas fa-cog"></i>
    </div>
</footer>

<!-- AI CHAT -->
<div id="ai-float" class="col">
    <div class="jb flex ac" style="padding:16px; border-bottom:1px solid #333; background:#1f1f22; border-radius:12px 12px 0 0;">
        <span style="font-weight:bold; color:var(--primary)"><i class="fas fa-sparkles"></i> AI Assistant</span>
        <div class="flex gap-2">
            <i class="fas fa-robot" title="CodeGPT-4" style="cursor:pointer; font-size:12px;"></i>
            <i class="fas fa-times" style="cursor:pointer" onclick="AI.toggle()"></i>
        </div>
    </div>
    <div id="ai-messages" style="flex:1; overflow-y:auto; padding:16px; display:flex; flex-direction:column; gap:12px;">
        <div class="msg-bubble msg-sys">Hello! I'm your AI coding assistant. I can help you write, debug, and explain code. How can I help you today?</div>
        <div class="msg-bubble msg-sys">Try asking me:
            <div style="margin-top:8px; font-size:12px;">
                â€¢ "Create a React component"<br>
                â€¢ "Debug this Python function"<br>
                â€¢ "Explain this algorithm"<br>
                â€¢ "Optimize this code"
            </div>
        </div>
    </div>
    <div style="padding:12px; border-top:1px solid #333; background:#18181b">
        <div style="display:flex; gap:8px;">
            <select id="ai-mode" class="btn" style="flex:0 0 auto; background:#27272a; border:1px solid #333;">
                <option>Code Help</option>
                <option>Debug</option>
                <option>Explain</option>
                <option>Refactor</option>
            </select>
            <input id="ai-input" class="btn" style="flex:1; height:40px; border:1px solid #333; color:white; background:#27272a;" placeholder="Ask me anything about code..." onkeydown="if(event.key==='Enter') AI.send()">
            <button class="btn icon" onclick="AI.send()" style="background:var(--primary); color:white;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<!-- SEARCH BAR -->
<div class="search-bar" id="search-bar">
    <div style="display:flex; gap:8px; margin-bottom:12px;">
        <input id="find-input" class="search-input" placeholder="Find" style="flex:1;">
        <input id="replace-input" class="search-input" placeholder="Replace" style="flex:1;">
    </div>
    <div style="display:flex; gap:8px; margin-bottom:12px;">
        <button class="btn" onclick="Search.findNext()">Find Next</button>
        <button class="btn" onclick="Search.replace()">Replace</button>
        <button class="btn" onclick="Search.replaceAll()">Replace All</button>
        <button class="btn" onclick="Search.close()">Close</button>
    </div>
    <div id="search-results-global" class="search-results"></div>
</div>

<!-- CONTEXT MENU -->
<div id="context-menu" class="context-menu hidden"></div>

<!-- MODALS -->
<div id="modal-new-project" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <span>Create New Project</span>
            <i class="fas fa-times modal-close" onclick="Modal.hide('new-project')"></i>
        </div>
        <div class="modal-body">
            <div style="margin-bottom:16px;">
                <div style="font-size:13px; margin-bottom:8px;">Project Name</div>
                <input id="project-name" class="search-input" value="my-project" style="width:100%;">
            </div>
            <div style="font-size:13px; margin-bottom:8px;">Template</div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                <div class="dropdown-item" onclick="Project.selectTemplate('react')" style="text-align:center; padding:12px; border:1px solid var(--border); border-radius:6px;">
                    <i class="fab fa-react" style="font-size:24px; color:#61dafb; margin-bottom:8px;"></i>
                    <div>React App</div>
                </div>
                <div class="dropdown-item" onclick="Project.selectTemplate('vue')" style="text-align:center; padding:12px; border:1px solid var(--border); border-radius:6px;">
                    <i class="fab fa-vuejs" style="font-size:24px; color:#42b883; margin-bottom:8px;"></i>
                    <div>Vue.js</div>
                </div>
                <div class="dropdown-item" onclick="Project.selectTemplate('node')" style="text-align:center; padding:12px; border:1px solid var(--border); border-radius:6px;">
                    <i class="fab fa-node-js" style="font-size:24px; color:#68a063; margin-bottom:8px;"></i>
                    <div>Node.js</div>
                </div>
                <div class="dropdown-item" onclick="Project.selectTemplate('python')" style="text-align:center; padding:12px; border:1px solid var(--border); border-radius:6px;">
                    <i class="fab fa-python" style="font-size:24px; color:#3776ab; margin-bottom:8px;"></i>
                    <div>Python</div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="Modal.hide('new-project')">Cancel</button>
            <button class="btn primary" onclick="Project.create()">Create Project</button>
        </div>
    </div>
</div>

<div id="modal-settings" class="modal">
    <div class="modal-content" style="width:500px;">
        <div class="modal-header">
            <span>Settings</span>
            <i class="fas fa-times modal-close" onclick="Modal.hide('settings')"></i>
        </div>
        <div class="modal-body">
            <div style="display:flex; flex-direction:column; gap:16px;">
                <div>
                    <div style="font-size:13px; margin-bottom:8px;">Editor Font Size</div>
                    <input type="range" id="font-size" min="10" max="24" value="14" style="width:100%;" oninput="Settings.updateFontSize(this.value)">
                </div>
                <div>
                    <div style="font-size:13px; margin-bottom:8px;">Theme</div>
                    <select id="theme-select" class="btn" style="width:100%;" onchange="Settings.changeTheme(this.value)">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                        <option value="high-contrast">High Contrast</option>
                    </select>
                </div>
                <div>
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" id="auto-save" checked>
                        <span style="font-size:13px;">Auto Save</span>
                    </label>
                </div>
                <div>
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" id="word-wrap">
                        <span style="font-size:13px;">Word Wrap</span>
                    </label>
                </div>
                <div>
                    <label style="display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" id="minimap" checked>
                        <span style="font-size:13px;">Show Minimap</span>
                    </label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="Modal.hide('settings')">Cancel</button>
            <button class="btn primary" onclick="Settings.save()">Save Settings</button>
        </div>
    </div>
</div>

<script>
/**
 * PRO CODE IDE v15.0 - ULTIMATE FULL-STACK ENVIRONMENT
 * Complete rewrite with enhanced features and bug fixes
 */

// GLOBAL STATE
const State = {
    files: {},
    tabs: [],
    activeTab: null,
    term: null,
    pyodide: null,
    monaco: null,
    editor: null,
    autoSave: true,
    theme: 'dark',
    projectName: 'Untitled Project',
    
    templates: {
        'react': {
            'index.html': `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>React App</title>
  <link rel="stylesheet" href="./src/style.css">
</head>
<body>
  <div id="root"></div>
  <script type="module" src="./src/main.jsx"></script>
</body>
</html>`,
            'src/main.jsx': `import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.jsx';
import './style.css';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);`,
            'src/App.jsx': `import React, { useState, useEffect } from 'react';
import './style.css';

function App() {
  const [count, setCount] = useState(0);
  const [theme, setTheme] = useState('light');

  useEffect(() => {
    document.title = \`Count: \${count}\`;
  }, [count]);

  return (
    <div className={\`app \${theme}\`}>
      <h1>Welcome to React!</h1>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
      <div className="controls">
        <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
          Toggle Theme
        </button>
        <button onClick={() => setCount(0)}>
          Reset
        </button>
      </div>
    </div>
  );
}

export default App;`,
            'src/style.css': `* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  background: #f5f5f5;
}

.app {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  transition: background 0.3s, color 0.3s;
}

.app.light {
  background: white;
  color: #333;
}

.app.dark {
  background: #1a1a1a;
  color: white;
}

h1 {
  font-size: 3rem;
  margin-bottom: 2rem;
  color: #61dafb;
}

p {
  font-size: 1.5rem;
  margin-bottom: 2rem;
}

button {
  padding: 12px 24px;
  font-size: 1rem;
  border: none;
  border-radius: 8px;
  background: #61dafb;
  color: #20232a;
  cursor: pointer;
  margin: 8px;
  transition: transform 0.2s, background 0.2s;
}

button:hover {
  background: #4fa8c7;
  transform: translateY(-2px);
}

.controls {
  margin-top: 20px;
  display: flex;
  gap: 10px;
}`
        },
        'vue': {
            'index.html': `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vue.js App</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
    .app { max-width: 800px; margin: 0 auto; padding: 40px; }
    .card { background: white; border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
    h1 { color: #333; margin-bottom: 20px; }
    button { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin: 5px; }
  </style>
</head>
<body>
  <div id="app"></div>
  <script src="./main.js"></script>
</body>
</html>`,
            'main.js': `const { createApp, ref, computed } = Vue;

createApp({
  setup() {
    const count = ref(0);
    const message = ref('Hello Vue!');
    const doubleCount = computed(() => count.value * 2);
    
    function increment() {
      count.value++;
    }
    
    function reset() {
      count.value = 0;
    }
    
    return { count, message, doubleCount, increment, reset };
  },
  template: \`
    <div class="app">
      <div class="card">
        <h1>{{ message }}</h1>
        <p>Count: {{ count }}</p>
        <p>Double: {{ doubleCount }}</p>
        <button @click="increment">Increment</button>
        <button @click="reset">Reset</button>
        <button @click="message = 'Vue is awesome!'">Change Message</button>
      </div>
    </div>
  \`
}).mount('#app');`
        },
        'node': {
            'package.json': `{
  "name": "node-server",
  "version": "1.0.0",
  "description": "A simple Node.js server",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "express": "^4.18.2"
  }
}`,
            'server.js': `const express = require('express');
const app = express();
const PORT = process.env.PORT || 3000;

app.use(express.json());
app.use(express.static('public'));

app.get('/', (req, res) => {
  res.send(\`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Node.js Server</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f0f0f0; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        code { background: #f5f5f5; padding: 2px 5px; border-radius: 3px; }
      </style>
    </head>
    <body>
      <div class="container">
        <h1>ðŸš€ Node.js Server Running</h1>
        <p>Server is running on port: <code>${PORT}</code></p>
        <p>Current time: <code>${new Date().toISOString()}</code></p>
        <h3>Available endpoints:</h3>
        <ul>
          <li><code>GET /api/status</code> - Server status</li>
          <li><code>GET /api/data</code> - Sample JSON data</li>
          <li><code>POST /api/echo</code> - Echo back posted data</li>
        </ul>
      </div>
    </body>
    </html>
  \`);
});

app.get('/api/status', (req, res) => {
  res.json({
    status: 'OK',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    memory: process.memoryUsage()
  });
});

app.get('/api/data', (req, res) => {
  res.json({
    message: 'Hello from Node.js!',
    items: ['Item 1', 'Item 2', 'Item 3'],
    count: 42
  });
});

app.post('/api/echo', (req, res) => {
  res.json({
    received: req.body,
    timestamp: new Date().toISOString()
  });
});

app.listen(PORT, () => {
  console.log(\`Server running on http://localhost:\${PORT}\`);
});`,
            'public/style.css': `body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  line-height: 1.6;
  color: #333;
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}`
        },
        'python': {
            'main.py': `import sys
import datetime
import json
import math
from typing import List, Dict, Optional

def fibonacci(n: int) -> List[int]:
    """Generate Fibonacci sequence up to n terms."""
    sequence = [0, 1]
    for i in range(2, n):
        sequence.append(sequence[i-1] + sequence[i-2])
    return sequence[:n]

class Calculator:
    """A simple calculator class."""
    
    def __init__(self):
        self.history = []
    
    def add(self, a: float, b: float) -> float:
        result = a + b
        self.history.append(f"{a} + {b} = {result}")
        return result
    
    def multiply(self, a: float, b: float) -> float:
        result = a * b
        self.history.append(f"{a} * {b} = {result}")
        return result
    
    def show_history(self):
        for entry in self.history:
            print(entry)

def main():
    print(f"Python Version: {sys.version}")
    print(f"Current Time: {datetime.datetime.now()}")
    
    # Fibonacci example
    n = 10
    fib_seq = fibonacci(n)
    print(f"\\nFirst {n} Fibonacci numbers: {fib_seq}")
    
    # Calculator example
    calc = Calculator()
    print(f"\\n5 + 3 = {calc.add(5, 3)}")
    print(f"4 * 6 = {calc.multiply(4, 6)}")
    print("\\nCalculation History:")
    calc.show_history()
    
    # Data structure example
    data = {
        "project": "Python Template",
        "version": "1.0.0",
        "features": ["Fast", "Reliable", "Easy to use"],
        "metadata": {
            "created": datetime.datetime.now().isoformat(),
            "author": "Pro Code IDE"
        }
    }
    
    print(f"\\nProject Data: {json.dumps(data, indent=2)}")

if __name__ == "__main__":
    main()`,
            'requirements.txt': `# Python Dependencies
python-dateutil==2.8.2
numpy==1.24.3
pandas==2.0.3
requests==2.31.0`,
            'utils/helpers.py': `"""Utility functions for the project."""

import os
import hashlib
from pathlib import Path

def get_file_hash(filepath: str) -> str:
    """Calculate MD5 hash of a file."""
    hash_md5 = hashlib.md5()
    with open(filepath, "rb") as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_md5.update(chunk)
    return hash_md5.hexdigest()

def ensure_directory(path: str):
    """Create directory if it doesn't exist."""
    Path(path).mkdir(parents=True, exist_ok=True)

def format_size(size_bytes: int) -> str:
    """Format file size in human readable format."""
    for unit in ['B', 'KB', 'MB', 'GB']:
        if size_bytes < 1024.0:
            return f"{size_bytes:.2f} {unit}"
        size_bytes /= 1024.0
    return f"{size_bytes:.2f} TB"`
        }
    }
};

// UTILITIES
const Utils = {
    toast: (msg, type = 'info', duration = 3000) => {
        const colors = {
            info: '#3b82f6', success: '#22c55e',
            warning: '#f59e0b', error: '#ef4444'
        };
        Toastify({
            text: msg,
            duration,
            gravity: "bottom",
            position: "right",
            style: { 
                background: colors[type] || colors.info,
                color: 'white',
                borderRadius: '6px',
                fontFamily: 'Inter',
                fontSize: '13px'
            }
        }).showToast();
    },
    
    uuid: () => 'id-' + Math.random().toString(36).substr(2, 9),
    
    debounce: (func, wait) => {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    },
    
    ext: (path) => path.split('.').pop().toLowerCase(),
    
    formatSize: (bytes) => {
        if (bytes === 0) return '0B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + sizes[i];
    },
    
    showProgress: (percent) => {
        const bar = document.getElementById('progress-bar');
        bar.style.width = percent + '%';
        if (percent >= 100) {
            setTimeout(() => bar.style.width = '0%', 500);
        }
    },
    
    confirm: (message, callback) => {
        if (window.confirm(message)) callback();
    }
};

// FILE SYSTEM
const FS = {
    init() {
        // Try to load from URL hash first
        const hash = window.location.hash.substring(1);
        if (hash) {
            try {
                const decompressed = LZString.decompressFromEncodedURIComponent(hash);
                if (decompressed) {
                    State.files = JSON.parse(decompressed);
                    Utils.toast('Project loaded from URL', 'success');
                }
            } catch(e) {
                console.warn('Failed to load from URL:', e);
            }
        }
        
        // Fallback to localStorage
        if (!State.files || Object.keys(State.files).length === 0) {
            const saved = localStorage.getItem('procode_v15');
            State.files = saved ? JSON.parse(saved) : { ...State.templates.react };
        }
        
        this.refreshTree();
        Utils.toast('File system initialized', 'success');
    },
    
    save() {
        if (!State.autoSave) return;
        
        // Save to localStorage
        localStorage.setItem('procode_v15', JSON.stringify(State.files));
        
        // Update URL hash with compressed data
        const compressed = LZString.compressToEncodedURIComponent(JSON.stringify(State.files));
        window.location.hash = compressed;
        
        // Visual feedback
        const saveIcon = document.querySelector('.fa-save');
        if (saveIcon) {
            saveIcon.style.color = '#22c55e';
            setTimeout(() => saveIcon.style.color = '', 1000);
        }
    },
    
    exists(path) {
        return State.files.hasOwnProperty(path);
    },
    
    write(path, content) {
        State.files[path] = content;
        this.save();
        
        // Update file size in footer
        if (path === State.activeTab) {
            document.getElementById('file-size').textContent = Utils.formatSize(content.length);
        }
    },
    
    read(path) {
        return State.files[path] || '';
    },
    
    delete(path) {
        if (!this.exists(path)) return;
        
        Utils.confirm(`Delete "${path}"?`, () => {
            delete State.files[path];
            Tabs.close(path);
            this.save();
            this.refreshTree();
            Utils.toast(`Deleted ${path}`, 'success');
        });
    },
    
    rename(oldPath, newPath) {
        if (oldPath === newPath) return;
        if (this.exists(newPath)) {
            Utils.toast('File already exists', 'error');
            return;
        }
        
        const content = State.files[oldPath];
        delete State.files[oldPath];
        State.files[newPath] = content;
        
        if (Tabs.isActive(oldPath)) Tabs.open(newPath);
        Tabs.close(oldPath);
        
        this.save();
        this.refreshTree();
        Utils.toast(`Renamed to ${newPath}`, 'success');
    },
    
    refreshTree() {
        const tree = document.getElementById('file-tree');
        tree.innerHTML = '';
        
        const structure = {};
        
        // Build hierarchical structure
        Object.keys(State.files).sort().forEach(path => {
            const parts = path.split('/');
            let current = structure;
            
            parts.forEach((part, i) => {
                if (!current[part]) {
                    current[part] = i === parts.length - 1 
                        ? { _type: 'file', path } 
                        : {};
                }
                current = current[part];
            });
        });
        
        // Render tree recursively
        const renderNode = (node, container, depth = 0) => {
            Object.keys(node).sort((a, b) => {
                const aIsFile = node[a]._type === 'file';
                const bIsFile = node[b]._type === 'file';
                if (aIsFile && !bIsFile) return 1;
                if (!aIsFile && bIsFile) return -1;
                return a.localeCompare(b);
            }).forEach(name => {
                const data = node[name];
                
                if (data._type === 'file') {
                    // File item
                    const item = document.createElement('div');
                    item.className = 't-item';
                    item.dataset.path = data.path;
                    
                    const ext = Utils.ext(name);
                    const icons = {
                        js: ['fab fa-js', '#facc15'],
                        jsx: ['fab fa-react', '#61dafb'],
                        ts: ['fab fa-js-square', '#3178c6'],
                        tsx: ['fab fa-react', '#3178c6'],
                        html: ['fab fa-html5', '#ea580c'],
                        css: ['fab fa-css3', '#0ea5e9'],
                        py: ['fab fa-python', '#3776ab'],
                        json: ['fas fa-brackets-curly', '#f59e0b'],
                        md: ['fab fa-markdown', '#ffffff'],
                        txt: ['fas fa-file-alt', '#a1a1aa'],
                        vue: ['fab fa-vuejs', '#42b883']
                    };
                    
                    const [icon, color] = icons[ext] || ['fas fa-file', '#71717a'];
                    const indent = 20 + (depth * 20);
                    
                    item.innerHTML = `
                        <div class="t-indent" style="padding-left:${indent}px">
                            <i class="${icon}" style="color:${color}; width:20px"></i>
                            <span style="margin-left:8px">${name}</span>
                        </div>
                    `;
                    
                    item.onclick = () => Tabs.open(data.path);
                    item.oncontextmenu = (e) => this.showContextMenu(e, data.path, 'file');
                    
                    if (State.activeTab === data.path) {
                        item.classList.add('active');
                    }
                    
                    container.appendChild(item);
                } else {
                    // Folder item
                    const item = document.createElement('div');
                    item.className = 't-item';
                    const indent = 20 + (depth * 20);
                    
                    item.innerHTML = `
                        <div class="t-indent" style="padding-left:${indent}px">
                            <i class="fas fa-folder" style="color:#d97706; width:20px"></i>
                            <span style="margin-left:8px">${name}</span>
                            <i class="fas fa-chevron-right" style="margin-left:auto; font-size:10px"></i>
                        </div>
                    `;
                    
                    const subContainer = document.createElement('div');
                    subContainer.className = 't-sub hidden';
                    
                    // Auto-expand if contains active file
                    if (State.activeTab && State.activeTab.startsWith(name + '/')) {
                        subContainer.classList.remove('hidden');
                        item.querySelector('.fa-chevron-right').style.transform = 'rotate(90deg)';
                    }
                    
                    item.onclick = (e) => {
                        e.stopPropagation();
                        subContainer.classList.toggle('hidden');
                        const icon = item.querySelector('.fa-chevron-right');
                        icon.style.transform = subContainer.classList.contains('hidden') 
                            ? '' 
                            : 'rotate(90deg)';
                    };
                    
                    item.oncontextmenu = (e) => this.showContextMenu(e, name + '/', 'folder');
                    
                    renderNode(data, subContainer, depth + 1);
                    container.appendChild(item);
                    container.appendChild(subContainer);
                }
            });
        };
        
        renderNode(structure, tree);
        
        // If no files, show empty state
        if (Object.keys(State.files).length === 0) {
            tree.innerHTML = `
                <div style="padding:40px 20px; text-align:center; color:var(--text-dim);">
                    <i class="fas fa-folder-open" style="font-size:32px; margin-bottom:16px;"></i>
                    <div>No files in project</div>
                    <div style="font-size:12px; margin-top:8px;">Create a file or import a project</div>
                </div>
            `;
        }
    },
    
    createFilePrompt() {
        const path = prompt('File path (e.g., src/components/Button.jsx):', 'newfile.js');
        if (path && !this.exists(path)) {
            this.write(path, '');
            this.refreshTree();
            Tabs.open(path);
            Utils.toast(`Created ${path}`, 'success');
        } else if (this.exists(path)) {
            Utils.toast('File already exists', 'error');
        }
    },
    
    createFolderPrompt() {
        const name = prompt('Folder name:', 'new-folder');
        if (name) {
            const path = name.endsWith('/') ? name : name + '/';
            this.write(path + '.keep', '# Folder marker');
            this.refreshTree();
            Utils.toast(`Created folder ${name}`, 'success');
        }
    },
    
    showContextMenu(e, path, type) {
        e.preventDefault();
        
        const menu = document.getElementById('context-menu');
        menu.innerHTML = '';
        menu.style.left = e.pageX + 'px';
        menu.style.top = e.pageY + 'px';
        menu.classList.remove('hidden');
        
        const addItem = (icon, text, action) => {
            const item = document.createElement('div');
            item.className = 'context-item';
            item.innerHTML = `<i class="fas ${icon}"></i> ${text}`;
            item.onclick = () => {
                action();
                menu.classList.add('hidden');
            };
            menu.appendChild(item);
        };
        
        if (type === 'file') {
            addItem('fa-edit', 'Rename', () => {
                const newName = prompt('New name:', path.split('/').pop());
                if (newName) {
                    const newPath = path.split('/').slice(0, -1).concat(newName).join('/');
                    this.rename(path, newPath);
                }
            });
            
            addItem('fa-trash', 'Delete', () => this.delete(path));
            addItem('fa-copy', 'Duplicate', () => {
                const newPath = path.replace(/(\.\w+)$/, '_copy$1');
                this.write(newPath, this.read(path));
                this.refreshTree();
            });
            
            addItem('fa-download', 'Download', () => {
                const content = this.read(path);
                const blob = new Blob([content], { type: 'text/plain' });
                saveAs(blob, path.split('/').pop());
            });
        } else {
            addItem('fa-folder-plus', 'New Folder', () => {
                const name = prompt('Folder name:');
                if (name) {
                    this.write(path + name + '/.keep', '');
                    this.refreshTree();
                }
            });
            
            addItem('fa-file-medical', 'New File', () => {
                const name = prompt('File name:');
                if (name) {
                    this.write(path + name, '');
                    this.refreshTree();
                }
            });
            
            if (path !== '/') {
                addItem('fa-trash', 'Delete Folder', () => {
                    const filesToDelete = Object.keys(State.files).filter(f => f.startsWith(path));
                    if (filesToDelete.length > 0) {
                        Utils.confirm(`Delete ${filesToDelete.length} files in ${path}?`, () => {
                            filesToDelete.forEach(f => delete State.files[f]);
                            this.save();
                            this.refreshTree();
                        });
                    }
                });
            }
        }
        
        // Close menu when clicking elsewhere
        setTimeout(() => {
            const closeMenu = () => {
                menu.classList.add('hidden');
                document.removeEventListener('click', closeMenu);
            };
            document.addEventListener('click', closeMenu);
        }, 0);
    },
    
    async exportZip() {
        Utils.showProgress(0);
        const zip = new JSZip();
        const files = Object.keys(State.files);
        
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            if (!file.endsWith('.keep')) {
                zip.file(file, State.files[file]);
            }
            Utils.showProgress((i / files.length) * 100);
        }
        
        const blob = await zip.generateAsync({ type: "blob" });
        saveAs(blob, `${State.projectName}.zip`);
        Utils.showProgress(100);
        Utils.toast('Project exported successfully!', 'success');
    },
    
    async importPrompt() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.zip,.json,.js,.jsx,.ts,.tsx,.html,.css,.py,.md,.txt';
        input.multiple = true;
        
        input.onchange = async (e) => {
            Utils.showProgress(0);
            const files = Array.from(e.target.files);
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                if (file.name.endsWith('.zip')) {
                    const zip = await JSZip.loadAsync(file);
                    const zipFiles = Object.keys(zip.files);
                    
                    for (let j = 0; j < zipFiles.length; j++) {
                        const zipFile = zipFiles[j];
                        const entry = zip.files[zipFile];
                        if (!entry.dir) {
                            const content = await entry.async("string");
                            State.files[zipFile] = content;
                        }
                        Utils.showProgress((j / zipFiles.length) * 50);
                    }
                } else {
                    const content = await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => resolve(e.target.result);
                        reader.readAsText(file);
                    });
                    State.files[file.name] = content;
                }
                
                Utils.showProgress((i / files.length) * 100);
            }
            
            this.save();
            this.refreshTree();
            Utils.showProgress(100);
            Utils.toast(`Imported ${files.length} files`, 'success');
        };
        
        input.click();
    }
};

// EDITOR MANAGER
const Editor = {
    instance: null,
    models: new Map(),
    
    async init() {
        return new Promise((resolve) => {
            require.config({ 
                paths: { 
                    'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' 
                } 
            });
            
            require(['vs/editor/editor.main'], () => {
                State.monaco = monaco;
                
                // Define themes
                monaco.editor.defineTheme('procode-dark', {
                    base: 'vs-dark',
                    inherit: true,
                    rules: [
                        { token: '', background: '09090b' },
                        { token: 'comment', foreground: '6b7280' }
                    ],
                    colors: {
                        'editor.background': '#09090b',
                        'editor.foreground': '#e4e4e7',
                        'editor.lineHighlightBackground': '#18181b',
                        'editorCursor.foreground': '#6366f1',
                        'editor.selectionBackground': '#374151'
                    }
                });
                
                monaco.editor.defineTheme('procode-light', {
                    base: 'vs',
                    inherit: true,
                    rules: [
                        { token: '', background: 'f9fafb' }
                    ],
                    colors: {
                        'editor.background': '#f9fafb',
                        'editor.foreground': '#111827',
                        'editor.lineHighlightBackground': '#f3f4f6',
                        'editorCursor.foreground': '#4f46e5'
                    }
                });
                
                // Create editor
                this.instance = monaco.editor.create(document.getElementById('monaco-root'), {
                    value: '',
                    language: 'javascript',
                    theme: 'procode-dark',
                    fontSize: 14,
                    fontFamily: "'JetBrains Mono', monospace",
                    minimap: { enabled: true },
                    scrollBeyondLastLine: false,
                    wordWrap: 'on',
                    smoothScrolling: true,
                    cursorBlinking: 'smooth',
                    cursorSmoothCaretAnimation: 'on',
                    formatOnPaste: true,
                    formatOnType: true,
                    automaticLayout: false,
                    glyphMargin: true,
                    lineNumbers: 'on',
                    folding: true,
                    lineDecorationsWidth: 10,
                    renderLineHighlight: 'all',
                    scrollbar: {
                        vertical: 'visible',
                        horizontal: 'visible',
                        useShadows: false
                    }
                });
                
                // Event listeners
                this.instance.onDidChangeModelContent(Utils.debounce(() => {
                    if (State.activeTab) {
                        const value = this.instance.getValue();
                        FS.write(State.activeTab, value);
                        
                        // Mark tab as unsaved
                        const tab = document.querySelector(`.tab[data-path="${State.activeTab}"]`);
                        if (tab) {
                            tab.classList.add('unsaved');
                        }
                    }
                }, 500));
                
                this.instance.onDidChangeCursorPosition((e) => {
                    document.getElementById('cursor-pos').textContent = 
                        `Ln ${e.position.lineNumber}, Col ${e.position.column}`;
                });
                
                this.instance.onDidChangeModel((e) => {
                    if (e.newModelUrl) {
                        const path = e.newModelUrl.path;
                        const ext = Utils.ext(path);
                        
                        // Update language indicator
                        const langs = {
                            js: 'JavaScript', jsx: 'JSX', ts: 'TypeScript', tsx: 'TSX',
                            html: 'HTML', css: 'CSS', py: 'Python', json: 'JSON',
                            md: 'Markdown', txt: 'Text'
                        };
                        
                        document.getElementById('file-lang').textContent = langs[ext] || ext.toUpperCase();
                        document.getElementById('file-size').textContent = 
                            Utils.formatSize(State.files[path]?.length || 0);
                    }
                });
                
                // Resize handling
                new ResizeObserver(() => this.instance.layout()).observe(
                    document.getElementById('editor-container')
                );
                
                // Initialize with first file
                const firstFile = Object.keys(State.files)[0];
                if (firstFile) {
                    Tabs.open(firstFile);
                }
                
                resolve();
            });
        });
    },
    
    setFile(path) {
        if (!this.instance) return;
        
        const content = FS.read(path);
        let model = this.models.get(path);
        
        if (!model) {
            const language = this.getLanguage(path);
            model = monaco.editor.createModel(content, language, monaco.Uri.file(path));
            this.models.set(path, model);
        } else {
            model.setValue(content);
        }
        
        this.instance.setModel(model);
        document.getElementById('monaco-root').style.display = 'block';
        document.getElementById('empty-state').style.display = 'none';
        
        // Clear unsaved marker
        const tab = document.querySelector(`.tab[data-path="${path}"]`);
        if (tab) {
            tab.classList.remove('unsaved');
        }
    },
    
    getLanguage(path) {
        const ext = Utils.ext(path);
        const map = {
            js: 'javascript', jsx: 'javascript', ts: 'typescript', tsx: 'typescript',
            html: 'html', css: 'css', py: 'python', json: 'json',
            md: 'markdown', txt: 'plaintext'
        };
        return map[ext] || 'plaintext';
    },
    
    format() {
        if (!this.instance) return;
        
        const action = this.instance.getAction('editor.action.formatDocument');
        if (action) {
            action.run().then(() => {
                Utils.toast('Code formatted', 'success');
            });
        }
    },
    
    find() {
        const searchBar = document.getElementById('search-bar');
        searchBar.classList.add('active');
        document.getElementById('find-input').focus();
    },
    
    replace() {
        this.find();
    },
    
    comment() {
        if (!this.instance) return;
        
        const action = this.instance.getAction('editor.action.commentLine');
        if (action) {
            action.run();
        }
    }
};

// TAB MANAGER
const Tabs = {
    open(path) {
        if (!State.tabs.includes(path)) {
            State.tabs.push(path);
            this.render();
        }
        this.activate(path);
    },
    
    close(path) {
        const tab = document.querySelector(`.tab[data-path="${path}"]`);
        const isUnsaved = tab && tab.classList.contains('unsaved');
        
        const closeTab = () => {
            State.tabs = State.tabs.filter(p => p !== path);
            
            if (State.activeTab === path) {
                State.activeTab = State.tabs.length > 0 ? State.tabs[State.tabs.length - 1] : null;
            }
            
            this.render();
            this.activate(State.activeTab);
            
            // Clean up model if no longer needed
            if (Editor.models.has(path) && !State.tabs.includes(path)) {
                const model = Editor.models.get(path);
                model.dispose();
                Editor.models.delete(path);
            }
        };
        
        if (isUnsaved) {
            if (confirm('You have unsaved changes. Close anyway?')) {
                closeTab();
            }
        } else {
            closeTab();
        }
    },
    
    activate(path) {
        State.activeTab = path;
        
        // Update tab UI
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.path === path);
        });
        
        // Update tree UI
        document.querySelectorAll('.t-item').forEach(item => {
            item.classList.toggle('active', item.dataset.path === path);
        });
        
        // Update editor
        if (path && Editor.instance) {
            Editor.setFile(path);
        } else {
            document.getElementById('monaco-root').style.display = 'none';
            document.getElementById('empty-state').style.display = 'flex';
        }
    },
    
    isActive(path) {
        return State.activeTab === path;
    },
    
    render() {
        const container = document.getElementById('tab-list');
        container.innerHTML = '';
        
        State.tabs.forEach(path => {
            const name = path.split('/').pop();
            const ext = Utils.ext(path);
            
            const tab = document.createElement('div');
            tab.className = `tab ${path === State.activeTab ? 'active' : ''}`;
            tab.dataset.path = path;
            
            const iconMap = {
                js: 'fab fa-js', jsx: 'fab fa-react', ts: 'fab fa-js-square',
                html: 'fab fa-html5', css: 'fab fa-css3', py: 'fab fa-python',
                json: 'fas fa-brackets-curly', md: 'fab fa-markdown'
            };
            
            const icon = iconMap[ext] || 'fas fa-file-code';
            
            tab.innerHTML = `
                <i class="${icon}"></i>
                <span style="flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap">${name}</span>
                <div class="dot"></div>
                <div class="close" onclick="event.stopPropagation(); Tabs.close('${path}')">Ã—</div>
            `;
            
            tab.onclick = () => this.activate(path);
            container.appendChild(tab);
        });
        
        // Update tab count in activity bar
        const tabCount = State.tabs.length;
        const explBtn = document.querySelector('.act-btn[data-id="expl"]');
        if (explBtn) {
            let badge = explBtn.querySelector('.badge');
            if (!badge) {
                badge = document.createElement('div');
                badge.className = 'badge';
                explBtn.appendChild(badge);
            }
            badge.textContent = tabCount > 99 ? '99+' : tabCount;
            badge.style.display = tabCount > 0 ? 'flex' : 'none';
        }
    }
};

// TERMINAL
const Term = {
    instance: null,
    fitAddon: null,
    searchAddon: null,
    
    init() {
        this.instance = new Terminal({
            theme: {
                background: '#09090b',
                foreground: '#e4e4e7',
                cursor: '#6366f1',
                black: '#000000',
                red: '#ef4444',
                green: '#22c55e',
                yellow: '#f59e0b',
                blue: '#3b82f6',
                magenta: '#a855f7',
                cyan: '#06b6d4',
                white: '#d1d5db'
            },
            fontFamily: "'JetBrains Mono', monospace",
            fontSize: 13,
            cursorBlink: true,
            cursorStyle: 'bar',
            allowTransparency: true,
            convertEol: true
        });
        
        this.fitAddon = new FitAddon.FitAddon();
        this.searchAddon = new SearchAddon.SearchAddon();
        
        this.instance.loadAddon(this.fitAddon);
        this.instance.loadAddon(this.searchAddon);
        this.instance.loadAddon(new WebLinksAddon.WebLinksAddon());
        
        this.instance.open(document.getElementById('term-host'));
        this.writeWelcome();
        
        // Setup command handling
        let currentLine = '';
        this.instance.onData(data => {
            switch (data) {
                case '\r': // Enter
                    this.instance.write('\r\n');
                    this.handleCommand(currentLine);
                    currentLine = '';
                    break;
                case '\u007f': // Backspace
                    if (currentLine.length > 0) {
                        this.instance.write('\b \b');
                        currentLine = currentLine.slice(0, -1);
                    }
                    break;
                default:
                    if (data >= ' ' && data <= '~') {
                        this.instance.write(data);
                        currentLine += data;
                    }
            }
        });
        
        // Fit on resize
        new ResizeObserver(() => this.fitAddon.fit()).observe(
            document.getElementById('panel-btm')
        );
        
        this.fitAddon.fit();
    },
    
    writeWelcome() {
        const welcome = `\x1b[1;36m
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•     â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  
   â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  
   â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•    â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
   â•šâ•â•     â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â•      â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•
\x1b[0m
Pro Code IDE v15.0 - Type 'help' for commands
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n`;
        
        this.instance.write(welcome);
        this.writePrompt();
    },
    
    writePrompt() {
        this.instance.write('\x1b[1;32muser@procode\x1b[0m:\x1b[1;34m~\x1b[0m$ ');
    },
    
    handleCommand(cmd) {
        const [command, ...args] = cmd.trim().split(' ');
        
        switch (command.toLowerCase()) {
            case 'help':
                this.instance.write(`Available commands:
  help                    Show this help
  clear                   Clear terminal
  ls [path]              List files
  cat <file>             Show file content
  cd <dir>               Change directory
  mkdir <name>           Create directory
  touch <file>           Create file
  rm <file>              Remove file
  python <file>          Run Python script
  node <file>            Run Node.js script
  exit                   Close terminal
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n`);
                break;
                
            case 'clear':
                this.instance.clear();
                break;
                
            case 'ls':
                const path = args[0] || '';
                const files = Object.keys(State.files)
                    .filter(f => f.startsWith(path))
                    .map(f => f.split('/').pop());
                this.instance.write(files.join('  ') + '\r\n');
                break;
                
            case 'cat':
                if (args[0] && FS.exists(args[0])) {
                    const content = FS.read(args[0]);
                    this.instance.write(content + '\r\n');
                } else {
                    this.instance.write(`File not found: ${args[0]}\r\n`);
                }
                break;
                
            case 'touch':
                if (args[0]) {
                    FS.write(args[0], '');
                    this.instance.write(`Created file: ${args[0]}\r\n`);
                }
                break;
                
            case 'exit':
                Layout.toggleLayout('terminal');
                break;
                
            case '':
                break;
                
            default:
                this.instance.write(`Command not found: ${command}\r\n`);
        }
        
        this.writePrompt();
    }
};

// RUNNER
const Runner = {
    async exec() {
        if (!State.activeTab) {
            Utils.toast('No active file to run', 'warning');
            return;
        }
        
        const path = State.activeTab;
        const ext = Utils.ext(path);
        
        Utils.showProgress(10);
        
        switch (ext) {
            case 'html':
            case 'js':
            case 'jsx':
            case 'css':
                await this.runWeb();
                break;
                
            case 'py':
                await this.runPython();
                break;
                
            default:
                Utils.toast(`Cannot run .${ext} files`, 'warning');
        }
        
        Utils.showProgress(100);
    },
    
    async runWeb() {
        Layout.toggleLayout('preview', true);
        
        // Find HTML entry point
        let htmlFile = 'index.html';
        if (!FS.exists(htmlFile)) {
            const htmlFiles = Object.keys(State.files).filter(f => f.endsWith('.html'));
            if (htmlFiles.length > 0) {
                htmlFile = htmlFiles[0];
            } else {
                // Generate basic HTML
                htmlFile = '_temp.html';
                const content = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pro Code Preview</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .loading { color: #666; }
    </style>
</head>
<body>
    <div class="loading">Loading preview...</div>
    <script>
        console.log('Preview loaded');
    </script>
</body>
</html>`;
                FS.write(htmlFile, content);
            }
        }
        
        const html = FS.read(htmlFile);
        const frame = document.getElementById('preview-frame');
        
        // Inject console logging
        const injectedScript = `
            <script>
                const originalLog = console.log;
                const originalError = console.error;
                const originalWarn = console.warn;
                
                console.log = (...args) => {
                    parent.postMessage({ type: 'log', level: 'log', args }, '*');
                    originalLog(...args);
                };
                
                console.error = (...args) => {
                    parent.postMessage({ type: 'log', level: 'error', args }, '*');
                    originalError(...args);
                };
                
                console.warn = (...args) => {
                    parent.postMessage({ type: 'log', level: 'warn', args }, '*');
                    originalWarn(...args);
                };
                
                window.addEventListener('error', (e) => {
                    parent.postMessage({ 
                        type: 'error', 
                        message: e.message,
                        filename: e.filename,
                        lineno: e.lineno,
                        colno: e.colno 
                    }, '*');
                });
            </script>
        `;
        
        const finalHTML = html.replace('</head>', injectedScript + '</head>');
        frame.srcdoc = finalHTML;
        
        Utils.toast('Preview loaded', 'success');
    },
    
    async runPython() {
        Layout.toggleLayout('terminal', true);
        
        if (!State.pyodide) {
            Term.instance.write('\x1b[33mLoading Pyodide runtime...\x1b[0m\r\n');
            
            try {
                State.pyodide = await loadPyodide({
                    stdout: (text) => Term.instance.write(text),
                    stderr: (text) => Term.instance.write('\x1b[31m' + text + '\x1b[0m')
                });
                
                // Load common packages
                await State.pyodide.loadPackage(['numpy', 'matplotlib']);
                Term.instance.write('\x1b[32mPyodide loaded successfully!\x1b[0m\r\n');
            } catch (error) {
                Term.instance.write(`\x1b[31mFailed to load Pyodide: ${error}\x1b[0m\r\n`);
                return;
            }
        }
        
        const code = FS.read(State.activeTab);
        Term.instance.write(`\x1b[33mRunning ${State.activeTab}...\x1b[0m\r\n`);
        
        try {
            await State.pyodide.runPythonAsync(code);
            Term.instance.write('\x1b[32mâœ“ Execution completed\x1b[0m\r\n');
        } catch (error) {
            Term.instance.write(`\x1b[31mâœ— Error: ${error.message}\x1b[0m\r\n`);
        }
        
        Term.writePrompt();
    },
    
    debug() {
        Utils.toast('Starting debug session...', 'info');
        Layout.toggleLayout('terminal', true);
        Panel.show('console');
        
        const consoleHost = document.getElementById('console-host');
        consoleHost.innerHTML += `<div style="color:#a855f7">[Debug] Starting debug session...</div>`;
    },
    
    stopDebug() {
        Utils.toast('Debug session stopped', 'info');
    },
    
    toggleMobileView() {
        const frame = document.getElementById('preview-frame');
        frame.style.width = '375px';
        frame.style.margin = '0 auto';
        frame.style.border = '1px solid #ccc';
        frame.style.borderRadius = '20px';
        frame.style.overflow = 'hidden';
    },
    
    popout() {
        const frame = document.getElementById('preview-frame');
        const win = window.open();
        win.document.write(frame.srcdoc);
        win.document.close();
    },
    
    exportHTML() {
        const frame = document.getElementById('preview-frame');
        const content = frame.srcdoc;
        const blob = new Blob([content], { type: 'text/html' });
        saveAs(blob, 'export.html');
        Utils.toast('HTML exported', 'success');
    }
};

// LAYOUT MANAGER
const Layout = {
    setSide(id) {
        // Update activity buttons
        document.querySelectorAll('.act-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.id === id);
        });
        
        // Update sidebars
        document.querySelectorAll('.sidebar').forEach(sidebar => {
            sidebar.classList.remove('active');
        });
        
        const target = document.getElementById(`side-${id}`);
        if (target) {
            target.classList.add('active');
        }
        
        // Refresh editor layout
        setTimeout(() => {
            if (Editor.instance) {
                Editor.instance.layout();
            }
        }, 100);
    },
    
    toggleLayout(panel, forceShow) {
        if (panel === 'preview') {
            const preview = document.getElementById('preview-wrap');
            const resizer = document.getElementById('rs-preview');
            
            const isVisible = preview.classList.contains('visible');
            
            if (!isVisible || forceShow) {
                preview.classList.add('visible');
                resizer.classList.remove('hidden');
                Runner.exec();
            } else {
                preview.classList.remove('visible');
                resizer.classList.add('hidden');
            }
        } else if (panel === 'terminal') {
            const terminal = document.getElementById('panel-btm');
            terminal.classList.toggle('hidden');
            
            if (!terminal.classList.contains('hidden')) {
                setTimeout(() => {
                    if (Term.fitAddon) {
                        Term.fitAddon.fit();
                    }
                }, 100);
            }
        }
        
        setTimeout(() => {
            if (Editor.instance) {
                Editor.instance.layout();
            }
        }, 300);
    },
    
    toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
        } else {
            document.exitFullscreen();
        }
    },
    
    zoomIn() {
        if (Editor.instance) {
            const size = Editor.instance.getOption(monaco.editor.EditorOption.fontSize);
            Editor.instance.updateOptions({ fontSize: size + 1 });
        }
    },
    
    zoomOut() {
        if (Editor.instance) {
            const size = Editor.instance.getOption(monaco.editor.EditorOption.fontSize);
            Editor.instance.updateOptions({ fontSize: Math.max(8, size - 1) });
        }
    }
};

// PANEL MANAGER
const Panel = {
    show(id) {
        // Hide all panels
        document.querySelectorAll('#panel-body > div').forEach(panel => {
            panel.classList.add('hidden');
        });
        
        // Show selected panel
        const target = document.getElementById(`${id}-host`);
        if (target) {
            target.classList.remove('hidden');
        }
        
        // Update tabs
        document.querySelectorAll('.panel-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        const activeTab = document.querySelector(`.panel-tab[onclick*="${id}"]`);
        if (activeTab) {
            activeTab.classList.add('active');
        }
        
        // Fit terminal if showing
        if (id === 'term' && Term.fitAddon) {
            setTimeout(() => Term.fitAddon.fit(), 50);
        }
    }
};

// AI ASSISTANT
const AI = {
    visible: false,
    thinking: false,
    
    toggle() {
        this.visible = !this.visible;
        const aiFloat = document.getElementById('ai-float');
        aiFloat.style.display = this.visible ? 'flex' : 'none';
        
        if (this.visible) {
            document.getElementById('ai-input').focus();
        }
    },
    
    async send() {
        const input = document.getElementById('ai-input');
        const text = input.value.trim();
        if (!text) return;
        
        this.addMessage(text, 'user');
        input.value = '';
        
        // Show thinking animation
        this.showThinking();
        
        // Simulate AI response (in real app, this would call an API)
        setTimeout(() => {
            this.hideThinking();
            const response = this.generateResponse(text);
            this.addMessage(response, 'system');
        }, 1500);
    },
    
    addMessage(text, type) {
        const container = document.getElementById('ai-messages');
        const message = document.createElement('div');
        
        if (type === 'user') {
            message.className = 'msg-bubble msg-user';
            message.textContent = text;
        } else {
            message.className = 'msg-bubble msg-sys';
            
            // Check for code blocks
            if (text.includes('```')) {
                const parts = text.split('```');
                let html = '';
                
                parts.forEach((part, index) => {
                    if (index % 2 === 0) {
                        html += `<div>${part}</div>`;
                    } else {
                        const lang = part.split('\n')[0];
                        const code = part.substring(lang.length).trim();
                        html += `<div class="code-block">${code}</div>`;
                    }
                });
                
                message.innerHTML = html;
            } else {
                message.textContent = text;
            }
        }
        
        container.appendChild(message);
        container.scrollTop = container.scrollHeight;
    },
    
    showThinking() {
        this.thinking = true;
        const container = document.getElementById('ai-messages');
        const thinking = document.createElement('div');
        thinking.className = 'thinking';
        thinking.innerHTML = `
            <span></span>
            <span></span>
            <span></span>
        `;
        thinking.id = 'thinking-animation';
        container.appendChild(thinking);
        container.scrollTop = container.scrollHeight;
    },
    
    hideThinking() {
        this.thinking = false;
        const thinking = document.getElementById('thinking-animation');
        if (thinking) {
            thinking.remove();
        }
    },
    
    generateResponse(query) {
        const responses = [
            `Here's an optimized version of your code:\n\n\`\`\`javascript\nfunction optimizeFunction(data) {\n  return data\n    .filter(item => item.active)\n    .map(item => ({\n      ...item,\n      processed: true\n    }));\n}\n\`\`\``,
            
            `The bug is likely in line 24. You're missing a null check. Try:\n\n\`\`\`javascript\nif (user && user.profile) {\n  console.log(user.profile.name);\n}\n\`\`\``,
            
            `Here's a React component for that:\n\n\`\`\`jsx\nimport React, { useState } from 'react';\n\nexport default function Counter() {\n  const [count, setCount] = useState(0);\n  \n  return (\n    <div>\n      <p>Count: {count}</p>\n      <button onClick={() => setCount(count + 1)}>\n        Increment\n      </button>\n    </div>\n  );\n}\n\`\`\``,
            
            `That algorithm has O(nÂ²) complexity. Here's an O(n) solution:\n\n\`\`\`python\ndef find_pair(nums, target):\n    seen = {}\n    for i, num in enumerate(nums):\n        complement = target - num\n        if complement in seen:\n            return [seen[complement], i]\n        seen[num] = i\n    return []\n\`\`\``
        ];
        
        return responses[Math.floor(Math.random() * responses.length)];
    }
};

// SEARCH FUNCTIONALITY
const Search = {
    find() {
        const query = document.getElementById('search-input').value;
        if (!query) return;
        
        const results = document.getElementById('search-results');
        results.innerHTML = '';
        
        Object.entries(State.files).forEach(([path, content]) => {
            const lines = content.split('\n');
            const matches = [];
            
            lines.forEach((line, index) => {
                if (line.includes(query)) {
                    matches.push({
                        line: index + 1,
                        preview: line.trim()
                    });
                }
            });
            
            if (matches.length > 0) {
                const result = document.createElement('div');
                result.style.padding = '8px';
                result.style.borderBottom = '1px solid var(--border)';
                result.innerHTML = `
                    <div style="font-weight:bold; font-size:12px; color:var(--primary);">
                        <i class="fas fa-file"></i> ${path}
                    </div>
                    ${matches.map(m => `
                        <div style="font-size:11px; margin-top:4px; color:var(--text);">
                            Line ${m.line}: ${m.preview}
                        </div>
                    `).join('')}
                `;
                
                result.onclick = () => {
                    Tabs.open(path);
                    // TODO: Scroll to line in editor
                };
                
                results.appendChild(result);
            }
        });
        
        if (results.children.length === 0) {
            results.innerHTML = '<div style="padding:20px; text-align:center; color:var(--text-dim);">No results found</div>';
        }
    },
    
    findNext() {
        // Monaco editor has built-in find functionality
        Editor.find();
    },
    
    replace() {
        Editor.replace();
    },
    
    replaceAll() {
        const find = document.getElementById('find-input').value;
        const replace = document.getElementById('replace-input').value;
        
        if (State.activeTab && find) {
            const content = FS.read(State.activeTab);
            const newContent = content.replace(new RegExp(find, 'g'), replace);
            FS.write(State.activeTab, newContent);
            Editor.setFile(State.activeTab);
            Utils.toast('Replaced all occurrences', 'success');
        }
    },
    
    close() {
        document.getElementById('search-bar').classList.remove('active');
    }
};

// PROJECT MANAGEMENT
const Project = {
    createFromTemplate() {
        Modal.show('new-project');
    },
    
    selectTemplate(template) {
        document.querySelectorAll('.dropdown-item').forEach(el => {
            el.style.borderColor = 'var(--border)';
        });
        
        event.target.closest('.dropdown-item').style.borderColor = 'var(--primary)';
        State.selectedTemplate = template;
    },
    
    create() {
        const name = document.getElementById('project-name').value;
        const template = State.selectedTemplate || 'react';
        
        State.projectName = name;
        State.files = { ...State.templates[template] };
        
        FS.save();
        FS.refreshTree();
        
        // Open main file
        const mainFile = Object.keys(State.files)[0];
        if (mainFile) {
            Tabs.open(mainFile);
        }
        
        Modal.hide('new-project');
        Utils.toast(`Project "${name}" created`, 'success');
    },
    
    share() {
        const compressed = LZString.compressToEncodedURIComponent(
            JSON.stringify(State.files)
        );
        
        const url = `${window.location.origin}${window.location.pathname}#${compressed}`;
        
        navigator.clipboard.writeText(url).then(() => {
            Utils.toast('Share URL copied to clipboard!', 'success');
        });
    }
};

// THEME MANAGER
const Theme = {
    toggle() {
        const isLight = document.body.classList.contains('theme-light');
        this.set(isLight ? 'dark' : 'light');
    },
    
    set(theme) {
        document.body.classList.remove('theme-light', 'theme-dark');
        document.body.classList.add(`theme-${theme}`);
        State.theme = theme;
        
        if (Editor.instance) {
            Editor.instance.updateOptions({
                theme: theme === 'light' ? 'procode-light' : 'procode-dark'
            });
        }
        
        // Save preference
        localStorage.setItem('procode_theme', theme);
    },
    
    load() {
        const saved = localStorage.getItem('procode_theme') || 'dark';
        this.set(saved);
    }
};

// SETTINGS
const Settings = {
    show() {
        Modal.show('settings');
        
        // Load current settings
        document.getElementById('font-size').value = 
            Editor.instance ? Editor.instance.getOption(monaco.editor.EditorOption.fontSize) : 14;
        document.getElementById('theme-select').value = State.theme;
        document.getElementById('auto-save').checked = State.autoSave;
        document.getElementById('word-wrap').checked = 
            Editor.instance ? Editor.instance.getOption(monaco.editor.EditorOption.wordWrap) === 'on' : false;
        document.getElementById('minimap').checked = 
            Editor.instance ? Editor.instance.getOption(monaco.editor.EditorOption.minimap).enabled : true;
    },
    
    save() {
        State.autoSave = document.getElementById('auto-save').checked;
        
        if (Editor.instance) {
            Editor.instance.updateOptions({
                fontSize: parseInt(document.getElementById('font-size').value),
                wordWrap: document.getElementById('word-wrap').checked ? 'on' : 'off',
                minimap: { enabled: document.getElementById('minimap').checked }
            });
        }
        
        Theme.set(document.getElementById('theme-select').value);
        Modal.hide('settings');
        Utils.toast('Settings saved', 'success');
    },
    
    updateFontSize(size) {
        if (Editor.instance) {
            Editor.instance.updateOptions({ fontSize: parseInt(size) });
        }
    },
    
    changeTheme(theme) {
        Theme.set(theme);
    }
};

// MODAL MANAGER
const Modal = {
    show(id) {
        document.getElementById(`modal-${id}`).classList.add('active');
    },
    
    hide(id) {
        document.getElementById(`modal-${id}`).classList.remove('active');
    }
};

// COMMAND PALETTE
const Command = {
    trigger(command) {
        switch (command) {
            case 'save':
                if (State.activeTab) {
                    const content = Editor.instance.getValue();
                    FS.write(State.activeTab, content);
                    Utils.toast('File saved', 'success');
                }
                break;
                
            case 'saveAll':
                if (Editor.instance && State.activeTab) {
                    const content = Editor.instance.getValue();
                    FS.write(State.activeTab, content);
                }
                Utils.toast('All files saved', 'success');
                break;
                
            case 'newFile':
                FS.createFilePrompt();
                break;
                
            case 'newFolder':
                FS.createFolderPrompt();
                break;
                
            case 'undo':
                if (Editor.instance) {
                    Editor.instance.trigger('keyboard', 'undo');
                }
                break;
                
            case 'redo':
                if (Editor.instance) {
                    Editor.instance.trigger('keyboard', 'redo');
                }
                break;
                
            case 'find':
                Editor.find();
                break;
                
            case 'replace':
                Editor.replace();
                break;
                
            case 'format':
                Editor.format();
                break;
                
            case 'comment':
                Editor.comment();
                break;
        }
    }
};

// INITIALIZATION
window.addEventListener('load', async () => {
    try {
        // Initialize subsystems
        await FS.init();
        await Editor.init();
        Term.init();
        Theme.load();
        
        // Setup keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl+S: Save
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                Command.trigger('save');
            }
            
            // Ctrl+P: Command palette
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                document.getElementById('spotlight').focus();
            }
            
            // Ctrl+F: Find
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                Command.trigger('find');
            }
            
            // F5: Run
            if (e.key === 'F5') {
                e.preventDefault();
                Runner.exec();
            }
            
            // F11: Fullscreen
            if (e.key === 'F11') {
                e.preventDefault();
                Layout.toggleFullscreen();
            }
            
            // Ctrl+`: Toggle terminal
            if (e.ctrlKey && e.key === '`') {
                e.preventDefault();
                Layout.toggleLayout('terminal');
            }
            
            // Ctrl+B: Toggle preview
            if (e.ctrlKey && e.key === 'b') {
                e.preventDefault();
                Layout.toggleLayout('preview');
            }
        });
        
        // Setup resizers
        const resizers = [
            { id: 'rs-side', target: 'side-expl', axis: 'horizontal' },
            { id: 'rs-panel', target: 'panel-btm', axis: 'vertical', invert: true },
            { id: 'rs-preview', target: 'preview-wrap', axis: 'horizontal', invert: true }
        ];
        
        resizers.forEach(({ id, target, axis, invert }) => {
            const resizer = document.getElementById(id);
            const element = document.getElementById(target);
            
            if (!resizer || !element) return;
            
            let isResizing = false;
            
            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                resizer.classList.add('dragging');
                document.body.style.cursor = axis === 'horizontal' ? 'col-resize' : 'row-resize';
                
                const startX = e.clientX;
                const startY = e.clientY;
                const startWidth = element.offsetWidth;
                const startHeight = element.offsetHeight;
                
                const onMouseMove = (e) => {
                    if (!isResizing) return;
                    
                    if (axis === 'horizontal') {
                        const diff = invert ? startX - e.clientX : e.clientX - startX;
                        element.style.width = (startWidth + diff) + 'px';
                    } else {
                        const diff = invert ? startY - e.clientY : e.clientY - startY;
                        element.style.height = (startHeight - diff) + 'px';
                    }
                    
                    if (Editor.instance) Editor.instance.layout();
                    if (Term.fitAddon) Term.fitAddon.fit();
                };
                
                const onMouseUp = () => {
                    isResizing = false;
                    resizer.classList.remove('dragging');
                    document.body.style.cursor = '';
                    window.removeEventListener('mousemove', onMouseMove);
                    window.removeEventListener('mouseup', onMouseUp);
                };
                
                window.addEventListener('mousemove', onMouseMove);
                window.addEventListener('mouseup', onMouseUp);
            });
        });
        
        // Handle preview iframe messages
        window.addEventListener('message', (e) => {
            if (e.data.type === 'log') {
                const consoleHost = document.getElementById('console-host');
                const line = document.createElement('div');
                line.style.color = e.data.level === 'error' ? '#ef4444' : 
                                  e.data.level === 'warn' ? '#f59e0b' : '#e4e4e7';
                line.style.fontFamily = "'JetBrains Mono', monospace";
                line.style.fontSize = '12px';
                line.style.padding = '2px 0';
                line.textContent = `> ${e.data.args.join(' ')}`;
                consoleHost.appendChild(line);
                consoleHost.scrollTop = consoleHost.scrollHeight;
            }
        });
        
        // Hide loader
        setTimeout(() => {
            document.getElementById('loader-overlay').style.display = 'none';
            Utils.toast('Pro Code IDE v15.0 Ready!', 'success');
        }, 1000);
        
    } catch (error) {
        console.error('Initialization error:', error);
        alert('Failed to initialize IDE. Please refresh the page.');
    }
});

// Prevent accidental tab close with unsaved changes
window.addEventListener('beforeunload', (e) => {
    const hasUnsaved = document.querySelector('.tab.unsaved');
    if (hasUnsaved) {
        e.preventDefault();
        e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
    }
});

</script>
</body>
</html>
